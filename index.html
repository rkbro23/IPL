<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Live Sports Player</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    * { box-sizing: border-box; font-family: 'Poppins', sans-serif; }
    body {
      margin: 0;
      background: #000;
      color: #fff;
    }
    header {
      padding: 15px;
      text-align: center;
      background: #111;
      color: #00ffc3;
      font-size: 1.5rem;
      font-weight: 600;
    }
    .video-container {
      position: relative;
      width: 100%;
      max-width: 800px;
      margin: auto;
    }
    video, iframe {
      width: 100%;
      height: 480px;
      border: 2px solid #00ffc3;
      border-radius: 10px;
    }
    .controls {
      position: absolute;
      width: 100%;
      top: 10px;
      left: 0;
      display: flex;
      justify-content: space-between;
      padding: 0 15px;
    }
    .record-btn, .server-btn {
      background: #00ffc3;
      border: none;
      padding: 6px 12px;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
      color: #000;
    }
    .quality-btn {
      position: absolute;
      right: 15px;
      bottom: 15px;
      background: #00ffc3;
      color: #000;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    .quality-options {
      display: none;
      position: absolute;
      bottom: 50px;
      right: 15px;
      background: #111;
      border: 1px solid #00ffc3;
      border-radius: 6px;
    }
    .quality-options div {
      padding: 8px 15px;
      cursor: pointer;
      color: #00ffc3;
    }
    .quality-options div:hover {
      background: #00ffc3;
      color: #000;
    }
    .popup {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .popup-content {
      background: #111;
      padding: 20px 30px;
      border-radius: 10px;
      text-align: center;
      border: 2px solid #00ffc3;
    }
    .popup-content button {
      margin-top: 15px;
      padding: 8px 15px;
      background: #00ffc3;
      color: #000;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="popup" id="popup">
    <div class="popup-content">
      <p>Join our Telegram channel for more content!</p>
      <a href="http://t.me/IPTVM3Y" target="_blank"><button>Join Now</button></a>
      <button onclick="document.getElementById('popup').style.display='none'">Cancel</button>
    </div>
  </div>

  <header>M3U Sports Player</header>
  <div class="video-container">
    <div class="controls">
      <button class="record-btn" id="recordBtn" onclick="toggleRecord()">Record</button>
      <button class="server-btn" onclick="toggleServer()">Server</button>
    </div>
    <div id="playerBox">
      <video id="mainPlayer" controls autoplay>
        <source src="https://live.dtvxtream.com/lunar-ipl-hindi" type="application/x-mpegURL" />
      </video>
    </div>
    <div class="quality-btn" onclick="toggleQuality()">Quality</div>
    <div class="quality-options" id="qualityOptions">
      <div>1080p</div>
      <div>720p</div>
      <div>360p</div>
    </div>
  </div>

  <script>
    const channels = [
      {
        name: "Star Sports 1 HD",
        servers: [
          "https://amitb3669.github.io/allinonereborn/str_sports_hindi.html",
          "https://amit-1.allinonereborn.in/jiotv11/app/ts_live_1984.m3u8"
        ]
      },
      {
        name: "Willow HD",
        servers: [
          "https://allinonereborn.com/spicetv-web/player.html?url=https%3A%2F%2Fallinonereborn.com%2Ftest.m3u8%3Fid%3D65088&name=WILLOW%20HD",
          "https://amitb3669.github.io/allinonereborn/t-sports.html"
        ]
      },
      {
        name: "MLB Baseball ENG",
        servers: [
          "https://allinonereborn.com/spicetv-web/player.html?url=https%3A%2F%2Fallinonereborn.com%2Ftest.m3u8%3Fid%3D44598&name=MLB%20NETWORK%20HD",
          "no-url"
        ]
      }
    ];

    let currentChannelIndex = 0;
    let currentServerIndex = 0;

    function toggleServer() {
      currentServerIndex = (currentServerIndex + 1) % channels[currentChannelIndex].servers.length;
      const url = channels[currentChannelIndex].servers[currentServerIndex];
      const playerBox = document.getElementById("playerBox");

      if (url !== "no-url") {
        if (url.includes("iframe") || url.includes("html") || url.includes("player")) {
          playerBox.innerHTML = `<iframe src="${url}" allowfullscreen></iframe>`;
        } else {
          playerBox.innerHTML = `<video id="mainPlayer" controls autoplay><source src="${url}" type="application/x-mpegURL"></video>`;
        }
      }
    }

    function toggleQuality() {
      const q = document.getElementById("qualityOptions");
      q.style.display = q.style.display === "block" ? "none" : "block";
    }

    let mediaRecorder, recordedBlobs = [];
    let isRecording = false;

    function toggleRecord() {
      const btn = document.getElementById("recordBtn");
      const video = document.getElementById("mainPlayer");
      if (!video || video.tagName !== 'VIDEO') {
        alert("Recording works only with .m3u8/video streams.");
        return;
      }
      if (!isRecording) {
        navigator.mediaDevices.getDisplayMedia({ video: true, audio: true }).then(stream => {
          recordedBlobs = [];
          mediaRecorder = new MediaRecorder(stream);
          mediaRecorder.ondataavailable = event => {
            if (event.data && event.data.size > 0) recordedBlobs.push(event.data);
          };
          mediaRecorder.onstop = () => {
            const blob = new Blob(recordedBlobs, { type: 'video/mp4' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = 'recording.mp4';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
          };
          mediaRecorder.start();
          btn.innerText = "Stop";
          isRecording = true;
        }).catch(err => alert("Permission denied or error: " + err));
      } else {
        mediaRecorder.stop();
        btn.innerText = "Record";
        isRecording = false;
      }
    }
  </script>
</body>
</html>
